<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>10 - 文件操作 | 刘玉新的数字花园</title>
    <meta name="description" content="Blog、CS、ML、Math">
    <link rel="stylesheet" href="/assets/style.8f477a73.css">
    <link rel="modulepreload" href="/assets/app.f2025cfc.js">
    <link rel="modulepreload" href="/assets/408_c-language10.md.6ef64195.lean.js">
    
    <link rel="icon" href="/img/logo.png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css">
  <script>(()=>{const e=localStorage.getItem("vitepress-theme-appearance"),a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-6b5fd0a9><!--[--><!--]--><!--[--><span tabindex="-1" data-v-45f6ae50></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-45f6ae50> Skip to content </a><!--]--><!----><header class="VPNav" data-v-6b5fd0a9 data-v-0e356168><div class="VPNavBar has-sidebar" data-v-0e356168 data-v-8856f192><div class="container" data-v-8856f192><div class="VPNavBarTitle has-sidebar" data-v-8856f192 data-v-6a6f7ff6><a class="title" href="/" data-v-6a6f7ff6><!--[--><img class="VPImage logo" src="/img/logo.png" data-v-73ae1788><!--]--><!--[-->应许之地<!--]--></a></div><div class="content" data-v-8856f192><!----><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-8856f192 data-v-a30758ee><span id="main-nav-aria-label" class="visually-hidden" data-v-a30758ee>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/about.html" data-v-a30758ee data-v-8fba5fa8 data-v-5704c677><!--[-->关于<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blog/" data-v-a30758ee data-v-8fba5fa8 data-v-5704c677><!--[-->我的博客<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/tools-tips/" data-v-a30758ee data-v-8fba5fa8 data-v-5704c677><!--[-->工具与技巧<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/machine-learning/" data-v-a30758ee data-v-8fba5fa8 data-v-5704c677><!--[-->机器学习<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/408/" data-v-a30758ee data-v-8fba5fa8 data-v-5704c677><!--[-->408 考研<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/mathematics/" data-v-a30758ee data-v-8fba5fa8 data-v-5704c677><!--[-->高等数学<!--]--><!----></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-8856f192 data-v-311055f2><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" data-v-311055f2 data-v-781f9d1b data-v-1dda4c9c><span class="check" data-v-1dda4c9c><span class="icon" data-v-1dda4c9c><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-781f9d1b><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-781f9d1b><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-8856f192 data-v-0ae890f7 data-v-4dcbaf3a><!--[--><a class="VPSocialLink" href="https://github.com/gvenusleo" title="github" target="_blank" rel="noopener noreferrer" data-v-4dcbaf3a data-v-48c45ef6><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-48c45ef6><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg><span class="visually-hidden" data-v-48c45ef6>github</span></a><a class="VPSocialLink" href="https://teitter.com/gvenusleo" title="twitter" target="_blank" rel="noopener noreferrer" data-v-4dcbaf3a data-v-48c45ef6><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-48c45ef6><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"></path></svg><span class="visually-hidden" data-v-48c45ef6>twitter</span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-8856f192 data-v-0562f5c0 data-v-8dccea88><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-8dccea88><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-8dccea88><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-8dccea88><div class="VPMenu" data-v-8dccea88 data-v-e73581a2><!----><!--[--><!--[--><!----><div class="group" data-v-0562f5c0><div class="item appearance" data-v-0562f5c0><p class="label" data-v-0562f5c0>Appearance</p><div class="appearance-action" data-v-0562f5c0><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" data-v-0562f5c0 data-v-781f9d1b data-v-1dda4c9c><span class="check" data-v-1dda4c9c><span class="icon" data-v-1dda4c9c><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-781f9d1b><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-781f9d1b><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-0562f5c0><div class="item social-links" data-v-0562f5c0><div class="VPSocialLinks social-links-list" data-v-0562f5c0 data-v-4dcbaf3a><!--[--><a class="VPSocialLink" href="https://github.com/gvenusleo" title="github" target="_blank" rel="noopener noreferrer" data-v-4dcbaf3a data-v-48c45ef6><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-48c45ef6><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg><span class="visually-hidden" data-v-48c45ef6>github</span></a><a class="VPSocialLink" href="https://teitter.com/gvenusleo" title="twitter" target="_blank" rel="noopener noreferrer" data-v-4dcbaf3a data-v-48c45ef6><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-48c45ef6><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"></path></svg><span class="visually-hidden" data-v-48c45ef6>twitter</span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-8856f192 data-v-6f008456><span class="container" data-v-6f008456><span class="top" data-v-6f008456></span><span class="middle" data-v-6f008456></span><span class="bottom" data-v-6f008456></span></span></button></div></div></div><!----></header><div class="VPLocalNav" data-v-6b5fd0a9 data-v-92b0f14a><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-92b0f14a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-92b0f14a><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-92b0f14a>Menu</span></button><a class="top-link" href="#" data-v-92b0f14a> Return to top </a></div><aside class="VPSidebar" data-v-6b5fd0a9 data-v-55e4c7db><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-55e4c7db><span class="visually-hidden" id="sidebar-aria-label" data-v-55e4c7db> Sidebar Navigation </span><!--[--><div class="group" data-v-55e4c7db><section class="VPSidebarGroup collapsible" data-v-55e4c7db data-v-1f69a7ed><div class="title" role="button" data-v-1f69a7ed><h2 class="title-text" data-v-1f69a7ed>C 程序设计</h2><div class="action" data-v-1f69a7ed><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-1f69a7ed><!--[--><a class="VPLink link" href="/408/c-language01.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>01 - C 语言导论</span><!--]--><!----></a><a class="VPLink link" href="/408/c-language02.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>02 - 数据结构</span><!--]--><!----></a><a class="VPLink link" href="/408/c-language03.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>03 - 输入与输出</span><!--]--><!----></a><a class="VPLink link" href="/408/c-language04.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>04 - 选择语句</span><!--]--><!----></a><a class="VPLink link" href="/408/c-language05.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>05 - 循环语句</span><!--]--><!----></a><a class="VPLink link" href="/408/c-language06.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>06 - 数组</span><!--]--><!----></a><a class="VPLink link" href="/408/c-language07.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>07 - 函数</span><!--]--><!----></a><a class="VPLink link" href="/408/c-language08.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>08 - 指针</span><!--]--><!----></a><a class="VPLink link" href="/408/c-language09.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>09 - 自定义数据类型</span><!--]--><!----></a><a class="VPLink link active" href="/408/c-language10.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>10 - 文件操作</span><!--]--><!----></a><!--]--></div></section></div><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-6b5fd0a9 data-v-a4c57a06><div class="VPDoc has-sidebar" data-v-a4c57a06 data-v-79ca2460><div class="container" data-v-79ca2460><div class="aside" data-v-79ca2460><div class="aside-curtain" data-v-79ca2460></div><div class="aside-container" data-v-79ca2460><div class="aside-content" data-v-79ca2460><div class="VPDocAside" data-v-79ca2460 data-v-779d834d><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline has-outline" data-v-779d834d data-v-51e5a8ce><div class="content" data-v-51e5a8ce><div class="outline-marker" data-v-51e5a8ce></div><div class="outline-title" data-v-51e5a8ce>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-51e5a8ce><span class="visually-hidden" id="doc-outline-aria-label" data-v-51e5a8ce> Table of Contents for current page </span><ul class="root" data-v-51e5a8ce><!--[--><li style="" data-v-51e5a8ce><a class="outline-link" href="#一、c-文件基本知识" data-v-51e5a8ce>一、C 文件基本知识</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#二、打开和关闭文件" data-v-51e5a8ce>二、打开和关闭文件</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#三、顺序读写数据文件" data-v-51e5a8ce>三、顺序读写数据文件</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#四、随机读写数据文件" data-v-51e5a8ce>四、随机读写数据文件</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#五、文件读写的出错检测" data-v-51e5a8ce>五、文件读写的出错检测</a><!----></li><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-779d834d></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-79ca2460><div class="content-container" data-v-79ca2460><!--[--><!--]--><main class="main" data-v-79ca2460><div style="position:relative;" class="vp-doc _408_c-language10" data-v-79ca2460><div><h1 id="_10-文件操作" tabindex="-1">10 - 文件操作 <a class="header-anchor" href="#_10-文件操作" aria-hidden="true">#</a></h1><h2 id="一、c-文件基本知识" tabindex="-1">一、C 文件基本知识 <a class="header-anchor" href="#一、c-文件基本知识" aria-hidden="true">#</a></h2><h3 id="_1-文件与文件分类" tabindex="-1">1. 文件与文件分类 <a class="header-anchor" href="#_1-文件与文件分类" aria-hidden="true">#</a></h3><p>文件(flie)一般是指<strong>存储在外部介质(如磁盘)上的数据的集合</strong>。操作系统是以文件为单位对数据进行管理的。文件有不同类型，C 语言中主要用到两种文件：</p><ol><li><strong>程序文件</strong>：包括源程序文件 <code>.c</code>、目标文件 <code>.obj</code>、可执行文件 <code>.exe</code>。文件的内容是程序代码。</li><li><strong>数据文件</strong>：文件的内容是供程序运行时读写的数据。</li></ol><p>我们主要讨论的是数据文件。</p><p>C 语言把文件看作一个字符(或字节)的序列，即由一个一个字符(或字节)的数据顺序组成。一个输入输出流就是一个字符流或字节(内容为二进制数据)流。C 的数据文件由一连串的字符(或字节)组成，对文件的存取是以字符(字节)为单位的。输入输出数据流的开始和结束仅受程序控制而不受物理符号(如回车换行符)控制，这就增加了处理的灵活性。这种文件称为<strong>流式文件</strong>。</p><p>一个文件要有唯一的文件标识，以便区分和引用，这就是<strong>文件名</strong>。文件标识包括 3 部分：①文件路径；②文件名主干；③文件后缀。如：</p><div class="language-shell line-numbers-mode"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">D:\cProgram\temp\file1.dat</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>工具数据的组织形式，将数据文件分为 <strong>ASCII 文件</strong>和<strong>二进制文件</strong>。数据在内存中是以二进制形式存储的，如果不加转换地输出到外存，就是二进制文件，可以认为它就是存储在内存的数据的映像，所以也称之为<strong>映像文件</strong>(image file)。如果要求在外存上以 ASCII 代码形式存储，则需要在存储前进行转换。ASCII 文件又称文本文件(text file)，每一个字节存放一个字符的 ASCII 代码。</p><p>用 ASCII 码形式输出时字节与字符一一对应，一个字节代表一个字符，因而便于对字符进行逐个处理，也便于输出字符。但一般占存储空间较多，而且要花费转换时间(二进制形式与 ASCII 码间的转换)。用二进制形式输出数值，可以节省外存空间和转换时间，把内存中的存储单元中的内容原封不动地输出到磁盘(或其他外部介质)上，此时每一个字节并不一定代表一个字符。如果程序运行过程中有的中间数据需要保存在外部介质上，以便在需要时再输人到内存，一般用二进制文件比较方便。在事务管理中，常有大批数据存放在磁盘上，随时调人十算机进行查询或处理，然后又把修改过的信息再存回磁盘，这时也常用二进制文件。</p><h3 id="_2-文件缓冲区" tabindex="-1">2. 文件缓冲区 <a class="header-anchor" href="#_2-文件缓冲区" aria-hidden="true">#</a></h3><p>ANSI C 标准采用“<strong>缓冲文件系统</strong>”处理数据文件，所谓缓冲文件系统是指系统自动地在内存区为程序中每一个正在使用的文件开辟一个文件缓冲区。从内存向磁盘输出数据必须先送到内存中的缓冲区，装满缓冲区后才一起送到磁盘去。如果从磁盘向计算机读入数据，则一次从磁盘文件将一批数据输人到内存缓冲区(充满缓冲区)，然后再从缓冲区逐个地将数据送到程序数据区(给程序变量)。这样做是为了节省存取时间，提高效率，缓冲区的大小由各个具体的 C 编译系统确定。</p><p><img src="/img/cl10.png" alt="文件缓冲区示意图"></p><h3 id="_3-文件类型指针" tabindex="-1">3. 文件类型指针 <a class="header-anchor" href="#_3-文件类型指针" aria-hidden="true">#</a></h3><p>缓冲文件系统中，关键的概念是“<strong>文件类型指针</strong>”，简称<strong>文件指针</strong>。每个被使用的文件都会在内存中开辟一个相应的文件信息区，用来存放文件的有关信息，这些信息是保存在一个系统声明的结构体变量 <code>FILE</code> 中。例如，一种 C 编译环境提供的 <code>stdio.h</code> 头文件中有以下文件类型声明：</p><div class="language-c line-numbers-mode"><span class="copy"></span><pre><code><span class="line"><span style="color:#F78C6C;">typedef</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">struct</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">short</span><span style="color:#F07178;"> level</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;">			</span><span style="color:#676E95;font-style:italic;">// 缓冲区“满”或“空”的长度</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">unsigned</span><span style="color:#F07178;"> flags</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;">			</span><span style="color:#676E95;font-style:italic;">// 文件状态标志</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">char</span><span style="color:#F07178;"> fd</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;">				</span><span style="color:#676E95;font-style:italic;">// 文件描述符</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">unsigned</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">char</span><span style="color:#F07178;"> hold</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;">		</span><span style="color:#676E95;font-style:italic;">// 如缓冲区无内容不读取字符</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">short</span><span style="color:#F07178;"> bsize</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;">			</span><span style="color:#676E95;font-style:italic;">// 缓冲区大小</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">unsigned</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">char</span><span style="color:#89DDFF;">*</span><span style="color:#F07178;"> buffer</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;">	</span><span style="color:#676E95;font-style:italic;">// 数据缓冲区的位置</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">unsigned</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">char</span><span style="color:#89DDFF;">*</span><span style="color:#F07178;"> curp</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;">	</span><span style="color:#676E95;font-style:italic;">// 文件位置标记指针当前的指向</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">unsigned</span><span style="color:#F07178;"> istemp</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;">		</span><span style="color:#676E95;font-style:italic;">// 临时文件指示器</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">short</span><span style="color:#F07178;"> token</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;">			</span><span style="color:#676E95;font-style:italic;">// 用于有效检查</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> FILE；</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>以上声明 FILE 结构体类型的信息包含在头文件 <code>stdio.h</code> 中。在程序中可以直接用 <code>FILE</code> 类型名定义变量。每一个 <code>FILE</code> 类型变量对应一个文件的信息区，在其中存放该文件的有关信息。例如：</p><div class="language-c line-numbers-mode"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">FILE fl；</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>以上定义了一个结构体变量 <code>f1</code>，用它来存放一个文件的有关信息。这些信息是在打开一个文件时由系统根据文件的情况自动放人的，在读写文件时需要用到这些信息，也会修改某些信息。例如在读一个字符后，文件信息区中的位置标记指针的指向就要改变。一般不定义 <code>FILE</code> 类型的变量命名，也就是不通过变量的名字来引用这些变量，而是设置一个指向 <code>FILE</code> 类型变量的指针变量，然后通过它来引用这些 <code>FILE</code> 类型变量。这样使用起来方便。如：</p><div class="language-c line-numbers-mode"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">FILE</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> fp</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>定义 <code>fp</code> 是一个指向 <code>FILE</code> 类型数据的指针变量。可以使 <code>fp</code> 指向某一个文件的文件信息区(是一个结构体变量)，通过该文件信息区中的信息就能够访问该文件。</p><div class="tip custom-block"><p class="custom-block-title">注意</p><p>指向文件的指针变量并不是指向外部介质上的数据文件的开头，而是指向内存中文件信息区的开头。</p></div><h2 id="二、打开和关闭文件" tabindex="-1">二、打开和关闭文件 <a class="header-anchor" href="#二、打开和关闭文件" aria-hidden="true">#</a></h2><p>文件读写之前要先打开，使用结束后要及时关闭。所谓“打开”是指为文件建立相应的休息区和文件缓冲区。编写程序时，打开文件的同时一般都指定一个指针变量指向该文件，通过指针变量对文件进行读写。所谓“关闭”就是撤销文件休息区和文件缓冲区，是指针变量不在指向该文件。</p><h3 id="_1-用-fopen-函数打开数据文件" tabindex="-1">1. 用 <code>fopen</code> 函数打开数据文件 <a class="header-anchor" href="#_1-用-fopen-函数打开数据文件" aria-hidden="true">#</a></h3><p>ANSI C 规定用标准输入输出函数 <code>fopen</code> 来实现打开文件，其调用方式为：</p><div class="language-c line-numbers-mode"><span class="copy"></span><pre><code><span class="line"><span style="color:#82AAFF;">fopen</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">文件名</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> 使用文件方式</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>fopen</code> 函数的返回值是一个指向该文件的指针变量。如果打开出错，则返回空指针 <code>NULL</code>。如：</p><div class="language-c line-numbers-mode"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">FILE</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> fp</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">fp </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">fopen</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">afile</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">r</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>使用文件方式包括：</p><table><thead><tr><th style="text-align:center;">文件使用方式</th><th style="text-align:center;">含义</th><th style="text-align:center;">如果指定文件不存在</th></tr></thead><tbody><tr><td style="text-align:center;"><code>r</code> 只读</td><td style="text-align:center;">为了输入数据打开一个已存在的文本文件</td><td style="text-align:center;">出错</td></tr><tr><td style="text-align:center;"><code>w</code> 只写</td><td style="text-align:center;">为了输出数据打开一个文本文件</td><td style="text-align:center;">建立新文件</td></tr><tr><td style="text-align:center;"><code>a</code> 追加</td><td style="text-align:center;">向文本文件尾添加数据</td><td style="text-align:center;">出错</td></tr><tr><td style="text-align:center;"><code>rb</code> 只读</td><td style="text-align:center;">为了输入数据打开一个二进制文件</td><td style="text-align:center;">出错</td></tr><tr><td style="text-align:center;"><code>wb</code> 只写</td><td style="text-align:center;">为了输出数据打开一个二进制文件</td><td style="text-align:center;">建立新文件</td></tr><tr><td style="text-align:center;"><code>ab</code> 追加</td><td style="text-align:center;">向二进制文件尾添加数据</td><td style="text-align:center;">出错</td></tr><tr><td style="text-align:center;"><code>r+</code> 读写</td><td style="text-align:center;">为读写打开一个文本文件</td><td style="text-align:center;">出错</td></tr><tr><td style="text-align:center;"><code>w+</code> 读写</td><td style="text-align:center;">为读写建立一个新的文本文件</td><td style="text-align:center;">建立新文件</td></tr><tr><td style="text-align:center;"><code>a+</code> 读写</td><td style="text-align:center;">为读写打开一个文本文件</td><td style="text-align:center;">出错</td></tr><tr><td style="text-align:center;"><code>rb+</code> 读写</td><td style="text-align:center;">为读写打开一个二进制文件</td><td style="text-align:center;">出错</td></tr><tr><td style="text-align:center;"><code>wb+</code> 读写</td><td style="text-align:center;">为读写建立一个新的二进制文件</td><td style="text-align:center;">建立新文件</td></tr><tr><td style="text-align:center;"><code>ab+</code> 读写</td><td style="text-align:center;">为读写打开一个二进制文件</td><td style="text-align:center;">存储</td></tr></tbody></table><h3 id="_2-用-fclose-函数关闭数据文件" tabindex="-1">2. 用 <code>fclose</code> 函数关闭数据文件 <a class="header-anchor" href="#_2-用-fclose-函数关闭数据文件" aria-hidden="true">#</a></h3><p><code>flose</code> 函数关闭文件的一般形式为：</p><div class="language-c line-numbers-mode"><span class="copy"></span><pre><code><span class="line"><span style="color:#82AAFF;">fclose</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">文件指针</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>当成功执行了关闭操作，该函数返回值为 0，否则为 EOF(-1)。</p><h2 id="三、顺序读写数据文件" tabindex="-1">三、顺序读写数据文件 <a class="header-anchor" href="#三、顺序读写数据文件" aria-hidden="true">#</a></h2><h3 id="_1-向文件读写字符" tabindex="-1">1. 向文件读写字符 <a class="header-anchor" href="#_1-向文件读写字符" aria-hidden="true">#</a></h3><p>C 语言提供两个函数对文本文件读写单个字符：</p><table><thead><tr><th style="text-align:center;">函数名</th><th style="text-align:center;">调用形式</th><th style="text-align:center;">功能</th><th style="text-align:center;">返回值</th></tr></thead><tbody><tr><td style="text-align:center;"><code>fgetc</code></td><td style="text-align:center;"><code>fgetc(fp)</code></td><td style="text-align:center;">从 <code>fp</code> 指向的文件读入有一个字符</td><td style="text-align:center;">读成功则返回所读字符，失败则返回文件结束标志 <code>EOF</code>(即 -1)</td></tr><tr><td style="text-align:center;"><code>fputc</code></td><td style="text-align:center;"><code>fputc(ch, fp)</code></td><td style="text-align:center;">把字符 <code>ch</code> 写到 <code>fp</code> 指向的文件中</td><td style="text-align:center;">输出成功则返回输出字符，失败则返回文件结束标志 <code>EOF</code>(即 -1)</td></tr></tbody></table><p>下面的例子实现了从键盘逐个输入字符并写入到磁盘文件中，知道输入一个 <code>#</code>：</p><div class="language-c line-numbers-mode"><span class="copy"></span><pre><code><span class="line"><span style="color:#89DDFF;font-style:italic;">#include</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">bits/types/FILE.h</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">#include</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">stdio.h</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">#include</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">stdlib.h</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    FILE</span><span style="color:#89DDFF;">*</span><span style="color:#F07178;"> fp</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;">                                  </span><span style="color:#676E95;font-style:italic;">// 定义文件指针</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">char</span><span style="color:#F07178;"> ch</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">filename</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">10</span><span style="color:#89DDFF;">];</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">scanf</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">%s</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> filename</span><span style="color:#89DDFF;">);</span><span style="color:#F07178;">                     </span><span style="color:#676E95;font-style:italic;">// 输入文件名</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">getchar</span><span style="color:#89DDFF;">();</span><span style="color:#F07178;">                                 </span><span style="color:#676E95;font-style:italic;">// 消化回车符</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">((</span><span style="color:#F07178;">fp </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">fopen</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">filename</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">w</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">))</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">NULL)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// 打开文件</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">printf</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Can not open file!</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">exit</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    ch </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">getchar</span><span style="color:#89DDFF;">();</span><span style="color:#F07178;">                            </span><span style="color:#676E95;font-style:italic;">// 输入第一个字符</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">while</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">ch </span><span style="color:#89DDFF;">!=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">#</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">fputc</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">ch</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> fp</span><span style="color:#89DDFF;">);</span><span style="color:#F07178;">                         </span><span style="color:#676E95;font-style:italic;">// 向磁盘文件按输出字符</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">putchar</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">ch</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#F07178;">        ch </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">getchar</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">fclose</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">fp</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">putchar</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">10</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>在访问磁盘文件时，是逐个字符(字节)进行的，为了知道当前访问到第几个字节，系统用“文件读写位置标记”来表示当前所访问的位置。开始时“文件读写位置标记”指向第1个字节，每访问完一个字节后，当前读写位置就指向下一个字节，即当前读写位置自动后移。为了知道对文件的读写是否完成，只须看文件读写位置是否移到文件的末尾。文件尾表示用标识符 <code>EOF</code>(end of file)表示，<code>EOF</code> 在 <code>stdio.h</code> 中被定义为 -1。</p><p>用 <code>feof</code> 函数可以检测文件尾标志是否已被读取过。如果文件尾标志已被读出，则表示文件已结束，此时 <code>feof</code> 函数值为真(以 1 表示)，否则 <code>feof</code> 函数值为假(以 0 表示)。</p><h3 id="_2-向文件读写字符串" tabindex="-1">2. 向文件读写字符串 <a class="header-anchor" href="#_2-向文件读写字符串" aria-hidden="true">#</a></h3><p>C 语言允许使用两个函数读写一个字符串：</p><table><thead><tr><th style="text-align:center;">函数名</th><th style="text-align:center;">调用形式</th><th style="text-align:center;">功能</th><th style="text-align:center;">返回值</th></tr></thead><tbody><tr><td style="text-align:center;"><code>fgets</code></td><td style="text-align:center;"><code>fgets(str, n, fp)</code></td><td style="text-align:center;">从 <code>fp</code> 指向的文件读入有一个长度为 n-1 的字符串，存放到字符数组 <code>str</code> 中</td><td style="text-align:center;">读成功则返回地址 <code>str</code>，失败则返回 <code>NULL</code></td></tr><tr><td style="text-align:center;"><code>fputs</code></td><td style="text-align:center;"><code>fputs(str, fp)</code></td><td style="text-align:center;">把 <code>str</code> 所指向的字符串写到 <code>fp</code> 指向的文件中</td><td style="text-align:center;">输出成功则返回 0，失败则返回非 0 值</td></tr></tbody></table><p>下面的例子实现了从键盘读入若干个字符串，按照字母大小排序后保存到磁盘文件中：</p><div class="language-c line-numbers-mode"><span class="copy"></span><pre><code><span class="line"><span style="color:#89DDFF;font-style:italic;">#include</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">bits/types/FILE.h</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">#include</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">stdio.h</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">#include</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">stdlib.h</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">#include</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">string.h</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    FILE</span><span style="color:#89DDFF;">*</span><span style="color:#F07178;"> fp</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">char</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">str</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">3</span><span style="color:#89DDFF;">][</span><span style="color:#F78C6C;">10</span><span style="color:#89DDFF;">],</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">temp</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">10</span><span style="color:#89DDFF;">];</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">int</span><span style="color:#F07178;"> i</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> j</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> k</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> n </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">3</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">i </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> i </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;"> n</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> i</span><span style="color:#89DDFF;">++)</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">scanf</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">%s</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">str</span><span style="color:#89DDFF;">[</span><span style="color:#F07178;">i</span><span style="color:#89DDFF;">]);</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">i </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> i </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;"> n </span><span style="color:#89DDFF;">-</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> i</span><span style="color:#89DDFF;">++)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        k </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> i</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">j </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> i </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> j </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;"> n</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> j</span><span style="color:#89DDFF;">++)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">strcmp</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">str</span><span style="color:#89DDFF;">[</span><span style="color:#F07178;">k</span><span style="color:#89DDFF;">],</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">str</span><span style="color:#89DDFF;">[</span><span style="color:#F07178;">j</span><span style="color:#89DDFF;">])</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#F07178;">                k </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> j</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">k </span><span style="color:#89DDFF;">!=</span><span style="color:#F07178;"> i</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#82AAFF;">strcpy</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">temp</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">str</span><span style="color:#89DDFF;">[</span><span style="color:#F07178;">i</span><span style="color:#89DDFF;">]);</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#82AAFF;">strcpy</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">str</span><span style="color:#89DDFF;">[</span><span style="color:#F07178;">i</span><span style="color:#89DDFF;">],</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">str</span><span style="color:#89DDFF;">[</span><span style="color:#F07178;">k</span><span style="color:#89DDFF;">]);</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#82AAFF;">strcpy</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">str</span><span style="color:#89DDFF;">[</span><span style="color:#F07178;">k</span><span style="color:#89DDFF;">],</span><span style="color:#F07178;"> temp</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#89DDFF;">((</span><span style="color:#F07178;">fp</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">fopen</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">file.txt</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">w</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">))==NULL)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">printf</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Can not open file!</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">exit</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">i</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;">i</span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">n</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;">i</span><span style="color:#89DDFF;">++){</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">fputs</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">str</span><span style="color:#89DDFF;">[</span><span style="color:#F07178;">i</span><span style="color:#89DDFF;">],</span><span style="color:#F07178;"> fp</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">fputs</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">\n</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> fp</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">printf</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">%s</span><span style="color:#A6ACCD;">\n</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">str</span><span style="color:#89DDFF;">[</span><span style="color:#F07178;">i</span><span style="color:#89DDFF;">]);</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h3 id="_3-格式化读取文本文件" tabindex="-1">3. 格式化读取文本文件 <a class="header-anchor" href="#_3-格式化读取文本文件" aria-hidden="true">#</a></h3><p>使用 <code>fprintf</code> 和 <code>fscanf</code> 函数可以实现对文件的格式化输入输出：</p><div class="language-c line-numbers-mode"><span class="copy"></span><pre><code><span class="line"><span style="color:#82AAFF;">fprintf</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">文件指针</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> 格式化字符串</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> 输出表列</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#82AAFF;">fscanf</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">文件指针</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> 格式化字符串</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> 输入表列</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>如：</p><div class="language-c line-numbers-mode"><span class="copy"></span><pre><code><span class="line"><span style="color:#82AAFF;">fprintf</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">fp</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">%d, %6.2f</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> i</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> f</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#82AAFF;">fscanf</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">fp</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">%d, %f</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">i</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">f</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>用这两个函数对磁盘文件读写，使用方便，易于理解，但由于在输入时要将文件中的 ASCII 码转换为二进制形式再保存在内存变量中，在输出时又要将内存中的二进制形式转换成字符，要花费较多时间。因此，在内存与磁盘频繁交换数据的情况下，最好不用 <code>fprintf</code> 和 <code>fscanf</code> 函数，而用下面的 <code>fread</code> 和 <code>fwrite</code> 函数进行二进制的读写。</p><h3 id="_4-二进制方式读写数据" tabindex="-1">4. 二进制方式读写数据 <a class="header-anchor" href="#_4-二进制方式读写数据" aria-hidden="true">#</a></h3><p>在程序中常需要一次输入输出一组数据(如数组或结构体变量的值)，C 语言使用 <code>fread</code> 函数从文件中读取一个数据块，用 <code>fwrite</code> 函数向文件写一个数据块。在读写时是以二进制形式进行的，因此操作的文件需以二进制形式打开。它们的一般形式为：</p><div class="language-c line-numbers-mode"><span class="copy"></span><pre><code><span class="line"><span style="color:#82AAFF;">fread</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">buffer</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> size</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> count</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> fp</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#82AAFF;">fwrite</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">buffer</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> size</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> count</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> fp</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>其中：</p><ul><li><code>buffer</code>：地址。对 <code>fread</code> 来说是用来存放从文件读入的数据的存储地址；对 <code>fwrite</code> 来说是把该地址开始的存储区中的数据向文件输出。</li><li><code>size</code>：要读写的字节数。</li><li><code>count</code> ：要读写的数据项的个数，每个数据项长度为 <code>size</code>。</li><li><code>fp</code>：<code>FILE</code> 类型的指针。</li></ul><p>下面的例子实现了从键盘上输入 10 组数组并转存到磁盘文件上：</p><div class="language-c line-numbers-mode"><span class="copy"></span><pre><code><span class="line"><span style="color:#89DDFF;font-style:italic;">#include</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">stdio.h</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">#define</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">SIZE</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">10</span></span>
<span class="line"><span style="color:#C792EA;">struct</span><span style="color:#A6ACCD;"> Student </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">char</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">name</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">10</span><span style="color:#89DDFF;">];</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">int</span><span style="color:#F07178;"> num</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">int</span><span style="color:#F07178;"> age</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> stud</span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">SIZE</span><span style="color:#89DDFF;">];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">save</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    FILE</span><span style="color:#89DDFF;">*</span><span style="color:#F07178;"> fp</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">int</span><span style="color:#F07178;"> i</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">((</span><span style="color:#F07178;">fp </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">fopen</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">stu.dat</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">wb</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">))</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">NULL)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">printf</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Can not open file!</span><span style="color:#A6ACCD;">\n</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">i </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> i </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;"> SIZE</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> i</span><span style="color:#89DDFF;">++)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">fwrite</span><span style="color:#89DDFF;">(&amp;</span><span style="color:#A6ACCD;">stud</span><span style="color:#89DDFF;">[</span><span style="color:#F07178;">i</span><span style="color:#89DDFF;">],</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">sizeof(</span><span style="color:#C792EA;">struct</span><span style="color:#F07178;"> Student</span><span style="color:#89DDFF;">),</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> fp</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#82AAFF;">printf</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">File write error!</span><span style="color:#A6ACCD;">\n</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">fclose</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">fp</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">int</span><span style="color:#F07178;"> i</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">i </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> i </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;"> SIZE</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> i</span><span style="color:#89DDFF;">++)</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">scanf</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">%s %d %d</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">stud</span><span style="color:#89DDFF;">[</span><span style="color:#F07178;">i</span><span style="color:#89DDFF;">].</span><span style="color:#A6ACCD;">name</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">stud</span><span style="color:#89DDFF;">[</span><span style="color:#F07178;">i</span><span style="color:#89DDFF;">].</span><span style="color:#A6ACCD;">num</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">stud</span><span style="color:#89DDFF;">[</span><span style="color:#F07178;">i</span><span style="color:#89DDFF;">].</span><span style="color:#A6ACCD;">age</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">save</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h2 id="四、随机读写数据文件" tabindex="-1">四、随机读写数据文件 <a class="header-anchor" href="#四、随机读写数据文件" aria-hidden="true">#</a></h2><p>随机访问不是按数据在文件中的物理位置次序进行读写，而是可以对任何位置上的数据进行访问，显然这种方法比顺序访问效率高得多。</p><p>系统为每一个文件设置了一个文件读写位置标记，用来指示接下来要读写的字符的位置。如果是顺序写文件，则每写完一个数据后，文件位置标记顺序向后移一个位置，然后在下一次执行写操作时把数据写人位置标记所指的位置。直到把全部数据写完，此时文件位置标记在最后一个数据之后。</p><p>可以根据读写的需要，人为地移动文件位置标记的位置。文件位置标记可以向前移、向后移，然后对该位置进行读写。从而实现在任何位置写人数据，在任何位置读取数据。</p><p>强制文件位置标记指向特定位置，可以使用以下函数实现：</p><ol><li><p>用 <code>rewind</code> 函数使文件位置标记指向文件开头，此函数无返回值。</p></li><li><p>用 <code>fseek</code> 函数改变文件位置标记，其调用形式为：</p><div class="language-c line-numbers-mode"><span class="copy"></span><pre><code><span class="line"><span style="color:#82AAFF;">fseek</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">文件类型指针</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> 位移量</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> 起始点</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>“起始点”用 0，1 或 2 代替，0 代表文件开始位置，1 为当前位置，2 为文件末尾位置。C 标准指定的名字如下表：</p><table><thead><tr><th style="text-align:center;">起始点</th><th style="text-align:center;">名字</th><th style="text-align:center;">用数字代表</th></tr></thead><tbody><tr><td style="text-align:center;">文件开始位置</td><td style="text-align:center;">SEEK_SET</td><td style="text-align:center;">0</td></tr><tr><td style="text-align:center;">文件当前位置</td><td style="text-align:center;">SEEK_CUR</td><td style="text-align:center;">1</td></tr><tr><td style="text-align:center;">文件末尾位置</td><td style="text-align:center;">SEEK_END</td><td style="text-align:center;">2</td></tr></tbody></table><p>“位移量”是指以“起始点”为基点，向前移动的字节数，应是一个 <code>long</code> 型数据。该函数一般用于二进制文件。</p></li><li><p>用 <code>ftell</code> 函数测定文件位置标记当前的位置，用相对于文件开头的位移量来表示。如果调用函数时出错，则返回 <code>-1L</code>。</p></li></ol><h2 id="五、文件读写的出错检测" tabindex="-1">五、文件读写的出错检测 <a class="header-anchor" href="#五、文件读写的出错检测" aria-hidden="true">#</a></h2><p>C 提供一些函数来检查输入输出函数调用时可能出现的错误：</p><ol><li><p><code>ferror</code> 函数：在调用各种输入输出函数(如 <code>putc</code>，<code>getc</code>，<code>fread</code> 和 <code>fwrite</code> 等)时，如果出现错误，除了函数返回值有所反映外，还可以用 <code>ferror</code> 函数检查。它的一般调用形式为：</p><div class="language-c line-numbers-mode"><span class="copy"></span><pre><code><span class="line"><span style="color:#82AAFF;">ferror</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">fp</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>如果返回值为 0(假)，表示未出错；如果返回一个非零值，表示出错。对同一个文件每一次调用输入输出函数，都会产生一个新的 <code>ferror</code> 函数值，因此，应当在调用一个输入输出函数后立即检查 <code>ferror</code> 函数的值，否则信息会丢失。在执行 <code>fopen</code> 函数时，<code>ferror</code> 函数的初始值自动置为 0。</p></li><li><p><code>clearerr</code> 函数：该函数作用是使文件出错标志和文件结束标志置为 0。假设在调用一个输入输出函数时发生错误，<code>ferror</code> 函数的值为一个非零值。应该立即调用 <code>clearerr(fp)</code> 使 <code>clearerr(fp)</code> 值变为 0，以便再进行下一次的检测。只要出现文件读写出错标志，它就一直保留，直到对同一文件调用 <code>clearerr</code> 函数或 <code>rewind</code> 函数，或任何其他一个输入输出函数。</p></li></ol></div></div></main><footer class="VPDocFooter" data-v-79ca2460 data-v-04568844><div class="edit-info" data-v-04568844><!----><!----></div><div class="prev-next" data-v-04568844><div class="pager" data-v-04568844><a class="pager-link prev" href="/408/c-language09.html" data-v-04568844><span class="desc" data-v-04568844>Previous page</span><span class="title" data-v-04568844>09 - 自定义数据类型</span></a></div><div class="has-prev pager" data-v-04568844><!----></div></div></footer><!--[--><!--]--></div></div></div></div></div><footer class="VPFooter has-sidebar" data-v-6b5fd0a9 data-v-5b331722><div class="container" data-v-5b331722><p class="message" data-v-5b331722>Licensed under the MIT License</p><p class="copyright" data-v-5b331722>Copyright © 2022 刘玉新</p></div></footer><!--[--><!--]--></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"408_c-language01.md\":\"dc59fde2\",\"408_c-language02.md\":\"f9af9f5e\",\"408_c-language03.md\":\"0cb8aa55\",\"408_c-language04.md\":\"611fa0e2\",\"408_c-language05.md\":\"4a83b5ff\",\"408_c-language06.md\":\"d0cb930b\",\"408_c-language07.md\":\"dbe1ba78\",\"408_c-language08.md\":\"a157988a\",\"408_c-language09.md\":\"aadb6bc8\",\"408_c-language10.md\":\"6ef64195\",\"408_index.md\":\"34701448\",\"about.md\":\"f9a75c88\",\"blog_220507.md\":\"f0bae2f9\",\"blog_220508.md\":\"f1edfca8\",\"blog_220516.md\":\"02025927\",\"blog_220602.md\":\"192e18a5\",\"blog_220619.md\":\"3e967688\",\"blog_index.md\":\"e08f61bd\",\"index.md\":\"c3bfd8ba\",\"machine-learning_data-analysis01.md\":\"5ce7c101\",\"machine-learning_data-analysis02.md\":\"09353784\",\"machine-learning_data-analysis03.md\":\"549e0886\",\"machine-learning_data-analysis04.md\":\"a2d71506\",\"machine-learning_index.md\":\"42a6a05a\",\"machine-learning_python-language01.md\":\"3c885a75\",\"machine-learning_python-language02.md\":\"a1399b6e\",\"machine-learning_python-language03.md\":\"69434067\",\"machine-learning_python-language04.md\":\"1fe5e895\",\"machine-learning_python-language05.md\":\"d3e8797d\",\"machine-learning_python-language06.md\":\"c07a19a6\",\"machine-learning_python-language07.md\":\"2f833426\",\"mathematics_01.md\":\"e167bee2\",\"mathematics_02.md\":\"adbe3889\",\"mathematics_03.md\":\"9f312d54\",\"mathematics_index.md\":\"88207553\",\"tools-tips_01.md\":\"11f1a1bc\",\"tools-tips_02.md\":\"29180954\",\"tools-tips_index.md\":\"9526692d\"}")</script>
    <script type="module" async src="/assets/app.f2025cfc.js"></script>
    
  </body>
</html>